<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é ˜å–æŠ•ç¥¨ç¢¼</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px 20px; background: #f0f2f5; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 350px; margin: auto; }
        input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; }
        button:disabled { background: #ccc; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ğŸ—³ï¸ é©—è­‰èº«åˆ†é ˜ç¢¼</h2>
        <p style="color: #666; font-size: 0.9rem;">ä¸€äººé™é ˜ä¸€æ¬¡ï¼Œå¯†ç¢¼é™æŠ•ä¸€ç¥¨</p>
        <input type="tel" id="phone" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼ (10ç¢¼)" maxlength="10">
        <button id="btn" onclick="start()">é ˜å–å°ˆå±¬å¯†ç¢¼</button>
        <p id="msg"></p>
    </div>

    <script>
        const GAS_URL ="https://script.google.com/macros/s/AKfycbzxZDv08s6ULEoUbohJiiGTJRKJq53oGj7B46Zkn4RtHHqrnPwg-uQtw6QiHAfcc9T4MA/exec";

        async function start() {
            const phone = document.getElementById('phone').value;
            if (!/^09\d{8}$/.test(phone)) return alert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ‰‹æ©Ÿè™Ÿç¢¼");

            const btn = document.getElementById('btn');
            btn.disabled = true;
            document.getElementById('msg').innerText = "å®‰å…¨æª¢æŸ¥ä¸­...";

            try {
                // ç°¡æ˜“æŠ“å– IP & æŒ‡ç´‹
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                const fingerprint = navigator.userAgent.length + navigator.language.length + screen.colorDepth + (screen.width * screen.height);

                const res = await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify({ 
                        action: "getToken", 
                        phone: phone, 
                        ip: ipData.ip, 
                        fingerprint: fingerprint.toString() 
                    })
                });
                const result = await res.json();
                
                if (result.status === "success") {
                    localStorage.setItem('v_token', result.token);
                    alert("é ˜å–æˆåŠŸï¼å³å°‡å‰å¾€æŠ•ç¥¨é ");
                    location.href = `index.html?token=${result.token}`;
                } else {
                    alert(result.message);
                    btn.disabled = false;
                }
            } catch (e) {
                alert("ç³»çµ±ç¹å¿™ï¼Œè«‹ç¨å¾Œå†è©¦");
                btn.disabled = false;
            }
        }
    </script>
</body>

</html>

