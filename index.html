<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å³æ™‚æŠ•ç¥¨æ’è¡Œæ¦œ</title>
    <style>
        body { font-family: sans-serif; background: #eee; padding: 10px; }
        .list-item { display: flex; align-items: center; background: white; margin: 8px 0; padding: 12px; border-radius: 10px; }
        .votes { margin-left: auto; font-weight: bold; color: #f39c12; }
        button { margin-left: 10px; padding: 6px 12px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h2 style="text-align:center;">ğŸ† å³æ™‚ç«¶è³½æ’å</h2>
    <div id="board">è¼‰å…¥ä¸­...</div>

    <script>
        const GAS_URL = "ä½ çš„_GAS_ç¶²å€";
        const urlParams = new URLSearchParams(window.location.search);
        let myToken = urlParams.get('token') || localStorage.getItem('v_token');

        async function fetchBoard() {
            const res = await fetch(GAS_URL);
            const data = await res.json();
            const board = document.getElementById('board');
            board.innerHTML = '';
            data.teams.forEach(t => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `<span>${t.name}</span><span class="votes">${t.votes} ç¥¨</span><button onclick="vote('${t.name}')">æŠ•ç¥¨</button>`;
                board.appendChild(item);
            });
        }

        async function vote(teamName) {
            if (!myToken) return alert("è«‹å…ˆæƒç¢¼é ˜å–å¯†ç¢¼");
            if (!confirm(`ç¢ºå®šæŠ•çµ¦ ${teamName}ï¼ŸæŠ•ç¥¨å¾Œå¯†ç¢¼å°‡ç«‹å³å¤±æ•ˆã€‚`)) return;

            const res = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ token: myToken, teamName: teamName })
            });
            const result = await res.json();
            alert(result.message);
            if (result.status === "success") {
                localStorage.removeItem('v_token'); // æŠ•å®Œå°±æ¸…é™¤
                myToken = null;
                fetchBoard();
            }
        }

        fetchBoard();
        setInterval(fetchBoard, 5000);
    </script>
</body>
</html>