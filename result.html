<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å³æ™‚æŠ•ç¥¨çµ±è¨ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; padding: 15px; background: #1a1a1a; color: white; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; }
        #header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        #time-display { font-family: monospace; color: #00ff00; font-size: 1.1rem; }
        .chart-container { flex-grow: 1; position: relative; width: 100%; }
        h2 { margin: 0; font-size: 1.2rem; }
    </style>
</head>
<body>
    <div id="header">
        <h2>ğŸ“Š å³æ™‚çµ±è¨ˆçœ‹æ¿</h2>
        <div id="time-display">0000/00/00 00:00:00</div>
    </div>
    <div class="chart-container">
        <canvas id="myChart"></canvas>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbxdACnIEYaFatj83Qx8mYe1tGLtJZQJ37Xx8le43D8IglAJRrGqrr9bYU4FdrEnNwzQtQ/exec";
        let myChart;

        // æ›´æ–°æ™‚é–“
        function updateClock() {
            const now = new Date();
            const str = now.getFullYear() + '/' + (now.getMonth()+1).toString().padStart(2,'0') + '/' + now.getDate().toString().padStart(2,'0') + ' ' +
                        now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0') + ':' + now.getSeconds().toString().padStart(2,'0');
            document.getElementById('time-display').innerText = str;
        }
        setInterval(updateClock, 1000);

        // åˆå§‹åŒ–åœ–è¡¨
        async function initChart() {
            const res = await fetch(GAS_URL);
            const data = await res.json();
            const labels = data.teams.map(t => t.name);
            const votes = data.teams.map(t => t.votes);

            const ctx = document.getElementById('myChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'bar', // ä½¿ç”¨æ©«æ¢åœ–
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ç¥¨æ•¸',
                        data: votes,
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    indexAxis: 'y', // è®“é•·æ¢åœ–æ©«å‘ï¼Œæ‰‹æ©Ÿæ›´æ˜“è®€
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: '#333' }, ticks: { color: '#fff', stepSize: 1 } },
                        y: { ticks: { color: '#fff', font: { size: 14 } } }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // å®šæœŸåˆ·æ–°æ•¸æ“š
        async function refreshData() {
            const res = await fetch(GAS_URL);
            const data = await res.json();
            myChart.data.datasets[0].data = data.teams.map(t => t.votes);
            myChart.update();
        }

        initChart();
        setInterval(refreshData, 5000);
        updateClock();
    </script>
</body>
</html>
